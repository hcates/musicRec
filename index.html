<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>tunes4you</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body onload="getToken()">
<h5>
    Welcome to tunes4you! <br>
    Get song recommendations based off of your favorite artists!
</h5>
<div>
    Enter an artist:
</div>
<form id="recForm">
    Artist 1:<br>
    <input type="text" name="artistOne"><br>
    <input type="button" onclick="onSubmit()" value="Submit">
</form>
<div>Results (Artist - Album - Song):</div>
<script>
    function getToken() {
        $.ajax({
            url: "/token",
            method: "GET",
            async: "false",
            success: function(data) {
                sessionStorage.setItem('token', data);
            }
        });
    }

    function onSubmit() {
        $.ajax({
            url: "https://api.spotify.com/v1/search?q=" + document.getElementsByName("artistOne")[0].value + "%20&type=artist",
            method: "GET",
            async: "false",
            headers: {
                "Authorization": "Bearer " + sessionStorage.getItem('token')
            },
            success: function (data) {
                sessionStorage.setItem('id', data.artists.items[0].id);
                $.ajax({
                    url: "https://api.spotify.com/v1/recommendations?limit=5&seed_artists=" + sessionStorage.getItem('id'),
                    method: "GET",
                    async: "false",
                    headers: {
                        "Authorization": "Bearer " + sessionStorage.getItem('token')
                    },
                    success: function (data) {
                        for (i = 0; i < 5; i++) {
                            var entry = document.createElement('li');
                            var text = JSON.stringify(data.tracks[i].album.artists[0].name) + " - " +
                                JSON.stringify(data.tracks[i].album.name) + " - " +
                                JSON.stringify(data.tracks[i].name);
                            var entryText = document.createTextNode(text);
                            entry.appendChild(entryText);
                            document.getElementById("results").appendChild(entry);
                        }
                        sessionStorage.removeItem('id');
                    }
                });
            }
        });
    }
</script>
<ol id="results">
</ol>
</body>
</html>